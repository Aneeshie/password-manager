#!/bin/bash

# Get directory of this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Load Modules
source "$SCRIPT_DIR/lib/utils.sh"
source "$SCRIPT_DIR/lib/db.sh"
source "$SCRIPT_DIR/lib/auth.sh"

# Load Commands
source "$SCRIPT_DIR/commands/init.sh"
source "$SCRIPT_DIR/commands/auth.sh"
source "$SCRIPT_DIR/commands/core.sh"
source "$SCRIPT_DIR/commands/retrieval.sh"
source "$SCRIPT_DIR/commands/management.sh"
source "$SCRIPT_DIR/commands/maintenance.sh"

# Main Dispatch
COMMAND="$1"
shift

case "$COMMAND" in
    init)
        cmd_init
        ;;
    unlock)
        cmd_unlock
        ;;
    lock)
        cmd_lock
        ;;
    add)
        cmd_add "$1"
        ;;
    list)
        cmd_list
        ;;
    get)
        cmd_get "$1"
        ;;
    search)
        cmd_search "$1"
        ;;
    edit)
        cmd_edit "$1"
        ;;
    delete)
        cmd_delete "$1"
        ;;
    audit)
        cmd_audit
        ;;
    backup)
        cmd_backup
        ;;
    restore)
        cmd_restore "$1"
        ;;
    *)
        echo "Usage: $0 {init|unlock|lock|add|list|get|search|edit|delete|audit|backup|restore}"
        exit 1
        ;;
esac
